# 基础原理

## 操作系统

进程管理、内存管理、文件管理时操作系统的三大核心功能。

## 系统调用

操作系统是一个系统程序，即为别的程序提供服务的程序。那么操作系统的服务是通过什么方式提供的呢？答案是**系统调用（system call）**。系统调用就是操作系统提供的应用程序界面（Application Programming Interface，API）。用户程序通过调用这些API获得操作系统的服务。

例如，，如果用户程序需要进行读磁盘操作，在C程序代码里将使用下面的语句：

```c
result = read(fd, buffer, nbytes)
```

这个read函数是C语言提供的库函数，而这个库函数本身则是调用的操作系统的read系统调用。注意这里有两个read，一个是read库函数，由程序语言提供；另一个是read系统调用，由操作系统提供。编译器在看到上述语句后将read库函数扩展为read系统调用。在真正执行时，操作系统完成上述文件的读操作。

系统调用按照功能可以划分为六大类：

* 进程管理类
* 文件管理类
* 设备管理类
* 内存管理类
* 信息维护类
* 通信类

系统调用分为三个阶段，分别是：

* 参数准备阶段
* 系统调用识别阶段
* 系统调用执行阶段

在参数准备阶段，需要使用系统服务的程序将系统调用所需要的参数，如上述例子中的fd、buffer、nbytes，压入栈中。然后调用read库函数。read库函数将read系统调用的代码放在一个约定好的寄存器里，通过陷入（trap，一种中断方式）将控制交给操作系统。由此进入第二阶段。操作系统获得控制权后，将系统调用代码从寄存器里取出，与操作系统维护的一张系统调用表进行比较，获得read系统调用的程序体所在的内存地址。之后跳到该地址，进度第三阶段，执行系统调用函数。系统调用执行完毕后返回到用户程序。