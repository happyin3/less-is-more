# 大型网站技术架构（李智慧）

> 不要去企图设计一个大型网站  
> 网站技术是为业务而存在的，除此毫无意义（不要炫技）  
> 技术是用来解决业务问题的，而业务的问题，也可以通过业务的手段去解决

## 大型网站架构演化

### 大型网站软件系统的特点

* 高并发，大流量
* 高可用
* 海量数据
* 用户分布广泛，网络情况复杂
* 安全环境恶劣
* 需求快速变更，发布频繁
* 渐进式发展

### 大型网站架构演化发展历程

* 单体架构
* 应用服务和数据服务分离
* 使用缓存改善网站性能
* 使用应用服务器集群改善网站的并发处理能力
* 数据库读写分离
* 使用反向代理和CDN加速网站响应
* 使用分布式文件系统和分布式数据库系统
* 使用NoSQL和搜索引擎
* 业务拆分
* 分布式服务

**驱动大型网站技术发展的主要力量是网站的业务发展**

网站架构师应该对成就自己技术成绩的完整事业心存感恩，并努力提高技术回馈业务。

### 网站架构设计误区

* 一味追随大公司的解决方案
* 为了技术而技术（**网站技术是为业务而存在的，除此毫无意义**）
* 企图用技术解决所有问题（**技术是用来解决业务问题的，而业务的问题，也可以通过业务的手段去解决**）

## 大型网站架构模式

> 关于什么是模式，建筑学词汇定义：“每一个模式描述了一个在我们周围不断重复发生的问题及该问题解决方案的核心。”

### 网站架构模式

* 分层（应用层、服务层、数据层）
  * 应用层
  * 服务层
  * 数据层
* 分割
* 分布式
  * 分布式应用和服务
  * 分布式静态资源
  * 分布式数据和存储
  * 分布式计算
  * 分布式配置
  * 分布式锁
  * 分布式文件
* 集群
* 缓存（**前提条件：一、数据访问热点不均衡；二、数据在某个时间段内有效**）
  * CDN
  * 反向代理
  * 本地缓存
  * 分布式缓存
* 异步
  * 提高系统可用性
  * 加快网站响应速度
  * 消除并发访问高峰
* 冗余（冷热备份）
* 自动化
  * 代码管理
  * 测试
  * 部署
  * 监控
  * 报警
  * 失效转移
  * 失效恢复
  * 降级
  * 资源分配
* 安全
  * 加密
  * 攻击
  * 过滤
  * 风险控制

### 总结

好的设计绝对不是模仿，不是生搬硬套某个模式，而是对问题深刻理解之上的创造与创新，即使是“微创新”，也是让人耳目一新的似曾相识。山寨与创新的最大区别不在于是否抄袭，是否模仿，而在于对问题和需求是否真正理解与把握。

## 大型网站核心架构要素

* 性能
* 可用性
* 伸缩性
* 扩展性
* 安全性

## 瞬时响应：网站的高性能架构

### 性能指标

* 响应时间
* 并发数
* 吞吐量
* 性能计数器

### Web前端性能优化

* 浏览器访问优化
  * 减少http请求
  * 使用浏览器缓存
  * 启用压缩
  * CSS放在页面最上面、JavaScript放在页面最下面
  * 减少Cookie传输
* CDN加速
* 反向代理
  
### 应用服务器性能优化

> 网站性能优化第一定律：优先考虑使用缓存优化性能

* 分布式缓存
* 异步（消息队列）
* 集群
* 代码优化

### 存储性能优化

* 机械硬盘 & 固态硬盘
* B+树 & LSM树
* RAID & HDFS

## 万无一失：网站的高可用架构

### 高可用的服务

* 分级管理
* 超时设置
* 异步调用
* 服务降级
* 幂等性设计

### 高可用的数据

### 高可用网站的软件质量保证

### 网站运行监控

## 永无止境：网站的伸缩性架构

### 网站架构的伸缩性设计

* 不同功能进行物理分离实现伸缩
  * 纵向分离（分层）
  * 横向分离（业务拆分）
* 单一功能通过集群模式实现伸缩

### 应用服务器集群的伸缩性设计

* HTTP重定向负载均衡
* DNS域名解析负载均衡
* 反向代理负载均衡
* IP负载均衡
* 数据链路层负载均衡
* 负载均衡算法
  * 轮询
  * 加权轮询
  * 随机
  * 最少连接
  * 源地址散列

### 分布式缓存集群的伸缩性设计

* 分布式缓存的一致性Hash算法

### 数据存储服务器集群的伸缩性设计

## 随需应变：网站的可扩展架构

### 利用分布式消息队列降低系统耦合性

* 事件驱动架构
* 分布式消息队列

### 利用分布式服务打造可复用的业务平台

### 可扩展的数据结构

### 利用开放平台建设网站生态圈

## 固若金汤：网站的安全架构

## 案例

### 秒杀系统

### 大型网站典型故障案例分析

* 写日志引发故障
* 高并发访问数据库引发的故障
* 高并发情况下锁引发的故障
* 缓存引发的故障
* 启动应用不同步引发的故障
* 大文件读写独占磁盘引发的故障
* 滥用生产环境引发的故障
* 不规范的流程引发的故障
* 不好的编程习惯引发的故障

### 总结

软件设计有两种分格，一种是将软件设计得很复杂，以使其缺陷没那么明显；一种是将软件设计的很简单，以使其乜有明显的缺陷。

## 架构师

### 架构师领导艺术

* 关注人而不是产品
* 发掘人的优秀（**是事情成就了人，而不是人成就了事**）
* 共享美好蓝图
* 共同参与架构
* 学会妥协（**自己是来做软件的，来实现客户价值的，不是来证明谁对谁错，不要企图去证明自己了不起**）
* 成就他人

### 网站架构师职场攻略

* 发现问题，寻找突破（**鱼是最后一个看见水的**）
* 提出问题，寻求支持（**给上司提封闭式问题，给下属提开放式问题**）
* 解决问题，达成绩效

### 漫话网站架构师