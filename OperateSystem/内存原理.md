# 内存原理

## 内存管理

内存管理要达到如下两个目标：

* 地址保护：一个程序不能访问另一个程序地址空间。
* 地址独立：程序发出的地址与物理主存地址无关。

### 虚拟内存

虚拟内存中心思想：将物理主存扩大到便宜、大容量的磁盘上，即将磁盘空间看做主存空间的一部分。

**单道编程的内存管理**

固定地址、静态地址翻译。问题：

* 整个要加载到内存空间中去，导致比物理内存大的程序无法运行。
* 只运行一个程序造成资源浪费。
* 可能无法在不同的操作系统下运行。

**多道编程的内存管理**

基址+极限，即可达到地址翻译和地址保护的目的。

**非固定分区的内存管理**

进程运行所需内存空间增长受限。

**交换内存管理**

交换就是将一个进程从内存倒到磁盘上，再将其从磁盘上加载到内存中的过程。这种交换的主要目的是为程序找到一片更大的空间，从而防止一个程序因空间不够而崩溃。

交换的问题，最重要的两个问题：空间浪费、程序大小受限。

到目前为止，我们已经接介绍了几种基本的内存管理方法，分别是固定加载地址的内存管理、固定分区的内存管理、非固定分区的内存管理和交换内存管理。固定加载地址的内存管理只适合于单道编程，而其他3中则可用于多道编程。这3种适用于多道编程的内存管理模式均使用同一种实现机制：基址与极限。

## 页式内存管理

分页系统的核心就是将虚拟内存空间和物理内存空间划分为大小相同的页面，并以页面作为内存空间的最小分配单位，一个程序的一个页面可以存放在任意一个物理页面里。

分页系统的核心是页面的翻译，即从虚拟页面到物理页面的映射。而这个翻译过程由内存管理单元（MMU）完成。

分页系统的问题：页表很大；可以通过多级页表优化，但是多级页表增加了翻译次数，降低了系统的速度。次级页面不在内存中，还需要加上一次磁盘的访问。

通过反转页表，在不增加页表级数的情况下降低页表所占的空间。

地址翻译因增加了内存访问次数而降低了系统效率。我们可以将该页面的翻译结果存放在缓存里，而无须在访问该页面的每个地址时再翻译一次。这种存放翻译结果的缓存称为翻译快表（TLB）。

### 缺页中断处理



